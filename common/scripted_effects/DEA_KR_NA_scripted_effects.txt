#시스템
KOR_show_effects_for_ordinance = {
	set_temp_variable = { KOR_legco_holding_value = KOR_legco_current_ordinance_id}
	set_temp_variable = { KOR_temp_legco_id = KOR_legco_holding_value }
	custom_effect_tooltip = KOR_show_effects_for_ordinance_tt
	effect_tooltip = {
		KOR_ordinances_effects = yes
	}
}

#입법
legco_introduce_ordinance = {
	set_variable = { KOR_legco_current_ordinance_id = KOR_temp_legco_id }
	log = "Guangdong ID [?GNG_temp_legco_id] Bill Initialize"
	custom_effect_tooltip = KOR_legco_bill_introduce_tooltip
	KOR_legco_votes_initialize = yes
}

KOR_legco_votes_initialize = {
	clamp_temp_variable = { #민주국민당
		var = KOR_legco_first_temp_support
		min = 0
		max = 1
	}
	clamp_temp_variable = { #대한촉성회
		var = KOR_legco_second_temp_support
		min = 0
		max = 1
	}
	clamp_temp_variable = { #사회노동당
		var = KOR_legco_third_temp_support
		min = 0
		max = 1
	}
	clamp_temp_variable = { #한국국민당
		var = KOR_legco_forth_temp_support
		min = 0
		max = 1
	}
	clamp_temp_variable = { #대한공산당
		var = KOR_legco_fifth_temp_support
		min = 0
		max = 1
	}
	clamp_temp_variable = { #한국민주당
		var = KOR_legco_sixth_temp_support
		min = 0
		max = 1
	}
	clamp_temp_variable = { #대한국민당
		var = KOR_legco_seventh_temp_support
		min = 0
		max = 1
	}
	clamp_temp_variable = { #민주당
		var = KOR_legco_eighth_temp_support
		min = 0
		max = 1
	}
	clamp_temp_variable = { #인민공화당
		var = KOR_legco_nineth_temp_support
		min = 0
		max = 1
	}
	clamp_temp_variable = { #대한신민당
		var = KOR_legco_tenth_temp_support
		min = 0
		max = 1
	}
	
	clamp_variable = { #민주국민당
		var = KOR_legco_first_temp_support
		min = 0
		max = 1
	}
	clamp_variable = { #대한촉성회
		var = KOR_legco_second_temp_support
		min = 0
		max = 1
	}
	clamp_variable = { #사회노동당
		var = KOR_legco_third_temp_support
		min = 0
		max = 1
	}
	clamp_variable = { #한국국민당
		var = KOR_legco_forth_temp_support
		min = 0
		max = 1
	}
	clamp_variable = { #대한공산당
		var = KOR_legco_fifth_temp_support
		min = 0
		max = 1
	}
	clamp_variable = { #한국민주당
		var = KOR_legco_sixth_temp_support
		min = 0
		max = 1
	}
	clamp_variable = { #대한국민당
		var = KOR_legco_seventh_temp_support
		min = 0
		max = 1
	}
	clamp_variable = { #민주당
		var = KOR_legco_eighth_temp_support
		min = 0
		max = 1
	}
	clamp_variable = { #인민공화당
		var = KOR_legco_nineth_temp_support
		min = 0
		max = 1
	}
	clamp_variable = { #대한신민당
		var = KOR_legco_tenth_temp_support
		min = 0
		max = 1
	}
	set_temp_variable = { KOR_first_support = KOR_legco_first_seats }
	multiply_temp_variable = { KOR_first_support = KOR_legco_first_temp_support }
	set_variable = { KOR_first_support = KOR_legco_first_seats }
	multiply_variable = { KOR_first_support = KOR_legco_first_temp_support }

	set_temp_variable = { KOR_second_support = KOR_legco_second_seats }
	multiply_temp_variable = { KOR_second_support = KOR_legco_second_temp_support }
	set_variable = { KOR_second_support = KOR_legco_second_seats }
	multiply_variable = { KOR_second_support = KOR_legco_second_temp_support }

	set_temp_variable = { KOR_third_support = KOR_legco_third_seats }
	multiply_temp_variable = { KOR_third_support = KOR_legco_third_temp_support }
	set_variable = { KOR_third_support = KOR_legco_third_seats }
	multiply_variable = { KOR_third_support = KOR_legco_third_temp_support }

	set_temp_variable = { KOR_forth_support = KOR_legco_forth_seats }
	multiply_temp_variable = { KOR_forth_support = KOR_legco_forth_temp_support }
	set_variable = { KOR_forth_support = KOR_legco_forth_seats }
	multiply_variable = { KOR_forth_support = KOR_legco_forth_temp_support }

	set_temp_variable = { KOR_fifth_support = KOR_legco_fifth_seats }
	multiply_temp_variable = { KOR_fifth_support = KOR_legco_fifth_temp_support }
	set_variable = { KOR_fifth_support = KOR_legco_fifth_seats }
	multiply_variable = { KOR_fifth_support = KOR_legco_fifth_temp_support }

	set_temp_variable = { KOR_sixth_support = KOR_legco_sixth_seats }
	multiply_temp_variable = { KOR_sixth_support = KOR_legco_sixth_temp_support }
	set_variable = { KOR_sixth_support = KOR_legco_sixth_seats }
	multiply_variable = { KOR_sixth_support = KOR_legco_sixth_temp_support }

	set_temp_variable = { KOR_seventh_support = KOR_legco_seventh_seats }
	multiply_temp_variable = { KOR_seventh_support = KOR_legco_seventh_temp_support }
	set_variable = { KOR_seventh_support = KOR_legco_seventh_seats }
	multiply_variable = { KOR_seventh_support = KOR_legco_seventh_temp_support }

	set_temp_variable = { KOR_eighth_support = KOR_legco_eighth_seats }
	multiply_temp_variable = { KOR_eighth_support = KOR_legco_eighth_temp_support }
	set_variable = { KOR_eighth_support = KOR_legco_eighth_seats }
	multiply_variable = { KOR_eighth_support = KOR_legco_eighth_temp_support }

	set_temp_variable = { KOR_nineth_support = KOR_legco_nineth_seats }
	multiply_temp_variable = { KOR_nineth_support = KOR_legco_nineth_temp_support }
	set_variable = { KOR_nineth_support = KOR_legco_nineth_seats }
	multiply_variable = { KOR_nineth_support = KOR_legco_nineth_temp_support }

	set_temp_variable = { KOR_tenth_support = KOR_legco_tenth_seats }
	multiply_temp_variable = { KOR_tenth_support = KOR_legco_tenth_temp_support }
	set_variable = { KOR_tenth_support = KOR_legco_tenth_seats }
	multiply_variable = { KOR_tenth_support = KOR_legco_tenth_temp_support }


	round_temp_variable = KOR_first_support
	round_temp_variable = KOR_second_support
	round_temp_variable = KOR_third_support
	round_temp_variable = KOR_forth_support
	round_temp_variable = KOR_fifth_support
	round_temp_variable = KOR_sixth_support
	round_temp_variable = KOR_seventh_support
	round_temp_variable = KOR_eighth_support
	round_temp_variable = KOR_nineth_support
	round_temp_variable = KOR_tenth_support

	round_variable = KOR_first_support
	round_variable = KOR_second_support
	round_variable = KOR_third_support
	round_variable = KOR_forth_support
	round_variable = KOR_fifth_support
	round_variable = KOR_sixth_support
	round_variable = KOR_seventh_support
	round_variable = KOR_eighth_support
	round_variable = KOR_nineth_support
	round_variable = KOR_tenth_support

	set_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_first_support }
	add_to_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_second_support }
	add_to_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_third_support }
	add_to_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_forth_support }
	add_to_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_fifth_support }
	add_to_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_sixth_support }
	add_to_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_seventh_support }
	add_to_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_eighth_support }
	add_to_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_nineth_support }
	add_to_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_tenth_support }

	set_variable = { KOR_legco_faction_support^1 = KOR_first_support }
	set_variable = { KOR_legco_faction_support^2 = KOR_second_support }
	set_variable = { KOR_legco_faction_support^3 = KOR_third_support }
	set_variable = { KOR_legco_faction_support^4 = KOR_forth_support }
	set_variable = { KOR_legco_faction_support^5 = KOR_fifth_support }
	set_variable = { KOR_legco_faction_support^6 = KOR_sixth_support }
	set_variable = { KOR_legco_faction_support^7 = KOR_seventh_support }
	set_variable = { KOR_legco_faction_support^8 = KOR_eighth_support }
	set_variable = { KOR_legco_faction_support^9 = KOR_nineth_support }
	set_variable = { KOR_legco_faction_support^10 = KOR_tenth_support }

	if = {
		limit = {
			NOT = { has_country_flag = GNG_hide_votes_ordinance }
		}
		custom_effect_tooltip = KOR_votes_initialize_percentages_tt
	}
	else = {
		clr_country_flag = GNG_hide_votes_ordinance
	}
	KOR_check_votes_legco = yes
}

KOR_check_votes_legco = {
	clamp_variable = {
		var = KOR_legco_faction_support^1
		min = 0
		max = KOR_legco_first_seats
	}
	clamp_variable = {
		var = KOR_legco_faction_support^2
		min = 0
		max = KOR_legco_second_seats
	}
	clamp_variable = {
		var = KOR_legco_faction_support^3
		min = 0
		max = KOR_legco_third_seats
	}
	clamp_variable = {
		var = KOR_legco_faction_support^4
		min = 0
		max = KOR_legco_forth_seats
	}
	clamp_variable = {
		var = KOR_legco_faction_support^5
		min = 0
		max = KOR_legco_fifth_seats
	}
	clamp_variable = {
		var = KOR_legco_faction_support^6
		min = 0
		max = KOR_legco_sixth_seats
	}
	clamp_variable = {
		var = KOR_legco_faction_support^7
		min = 0
		max = KOR_legco_seventh_seats
	}
	clamp_variable = {
		var = KOR_legco_faction_support^8
		min = 0
		max = KOR_legco_eighth_seats
	}
	clamp_variable = {
		var = KOR_legco_faction_support^9
		min = 0
		max = KOR_legco_nineth_seats
	}
	clamp_variable = {
		var = KOR_legco_faction_support^10
		min = 0
		max = KOR_legco_tenth_seats
	}
	for_each_loop = {
		array = KOR_legco_faction_support
		index = i
		value = val

		if = {
			limit = { check_variable = { i < 11 } }
			round_variable = KOR_legco_faction_support^i
		}
	}
	set_temp_variable = { KOR_Current_Ordinance_Votes_temp = 0 }
	for_each_loop = {
		array = KOR_legco_faction_support
		add_to_temp_variable = { KOR_Current_Ordinance_Votes_temp = KOR_legco_faction_support^i }
	}
	set_variable = { KOR_Current_Ordinance_Votes = KOR_Current_Ordinance_Votes_temp }
}

#개표
legco_ordinance_vote_start = {
	if = {
		limit = {
			NOT = {
				has_country_flag = this_is_resolution
			}
		}
		set_variable = { KOR_legco_vote_days = 7 }
	}
	if = {
		limit = {
			has_country_flag = this_is_resolution
		}
		set_variable = { KOR_legco_vote_days = 1 }
	}
	clr_country_flag = this_is_resolution
	hidden_effect = {
		country_event = {
			id = KOR_parliament.1
			days = 1
		}
		# set_temp_variable = { alert_id = token:Alert_GNG_LegCo_Bill }
		# add_TNO_alert_unless_exists = yes
	}
	custom_effect_tooltip = KOR_legco_bill_voting_tooltip
	# log = "Guangdong ID [?GNG_temp_legco_id] Bill Vote Start"
}

legco_bill_conclude = {
	clr_country_flag = KOR_show_effects_for_ordinance
	# set_temp_variable = { alert_id = token:Alert_GNG_LegCo_Bill }
	# remove_TNO_alert = yes
	# if = {
	# 	limit = {
	# 		has_country_flag = GNG_riots_negotiations_stall
	# 	}
	# 	clr_country_flag = GNG_riots_negotiations_stall
	# 	country_event = { id = guangdong_RiotsNegotiations.9 days = 3 }
	# }
	if = {
		limit = {
			KOR = {
				is_ai = no
			}
		}
		if = {
			limit = {
				check_variable = { KOR_Current_Ordinance_Votes > 199 }
			}
			#log = "Guangdong ID [?GNG_legco_current_ordinance_id] Bill Passed"
			KOR_pass_ordinance = yes
		}
		else_if = {
			limit = {
				check_variable = { KOR_Current_Ordinance_Votes < 200 }
			}
			#log = "Guangdong ID [?GNG_legco_current_ordinance_id] Bill Fails"
			KOR_fail_ordinance = yes
		}
	}
	# else = {
	# 	if = {
	# 		limit = {
	# 			has_country_flag = GNG_AI_Guarantee_Pass
	# 		}
	# 		clr_country_flag = GNG_AI_Guarantee_Pass
	# 		GNG_pass_ordinance = yes
	# 	}
	# 	else_if = {
	# 		limit = {
	# 			has_country_flag = GNG_AI_Guarantee_Fail
	# 		}
	# 		clr_country_flag = GNG_AI_Guarantee_Fail
	# 		GNG_fail_ordinance = yes
	# 	}
	# 	else = {
	# 		random_list = {
	# 			75 = {
	# 				GNG_pass_ordinance = yes
	# 			}
	# 			25 = {
	# 				modifier = {
	# 					factor = 0
	# 					has_game_rule = {
	# 						rule = GNG_AI_ORDINANCES
	# 						option = GNG_AI_ORDINANCES_YES
	# 					}
	# 				}
	# 				GNG_fail_ordinance = yes
	# 			}
	# 		}
	# 	}
	# }
}

KOR_pass_ordinance = {
	if = {
		limit = { check_variable = { KOR_legco_current_ordinance_id > 0 } }
		add_to_array = { array = KOR_legco_history value = KOR_legco_current_ordinance_id index = 0 }
		add_to_array = { array = KOR_legco_passage value = 1 index = 0 }
		set_variable = { KOR_legco_amendments_1^KOR_legco_ordinance_id = KOR_legco_amendments_1^KOR_legco_current_ordinance_id }
		set_variable = { KOR_legco_amendments_2^KOR_legco_ordinance_id = KOR_legco_amendments_2^KOR_legco_current_ordinance_id }
		set_variable = { KOR_legco_amendments_3^KOR_legco_ordinance_id = KOR_legco_amendments_3^KOR_legco_current_ordinance_id }
		set_variable = { KOR_legco_amendments_4^KOR_legco_ordinance_id = KOR_legco_amendments_4^KOR_legco_current_ordinance_id }
		set_variable = { KOR_legco_amendments_5^KOR_legco_ordinance_id = KOR_legco_amendments_5^KOR_legco_current_ordinance_id }
		set_variable = { KOR_legco_amendments_6^KOR_legco_ordinance_id = KOR_legco_amendments_6^KOR_legco_current_ordinance_id }
		set_variable = { KOR_legco_amendments_7^KOR_legco_ordinance_id = KOR_legco_amendments_7^KOR_legco_current_ordinance_id }
		set_variable = { KOR_legco_amendments_8^KOR_legco_ordinance_id = KOR_legco_amendments_8^KOR_legco_current_ordinance_id }
		set_variable = { KOR_legco_amendments_9^KOR_legco_ordinance_id = KOR_legco_amendments_9^KOR_legco_current_ordinance_id }
		set_variable = { KOR_legco_amendments_10^KOR_legco_ordinance_id = KOR_legco_amendments_10^KOR_legco_current_ordinance_id }
		set_variable = { KOR_legco_holding_value = KOR_legco_current_ordinance_id }
		KOR_pass_ordinance_event_effect = yes
		set_variable = { KOR_legco_current_ordinance_id = 0 }
		set_variable = { KOR_legco_current_voting = 0 }
	}
}

KOR_pass_ordinance_event_effect = {
	if = {
		limit = {
			check_variable = { KOR_legco_current_ordinance_id = 1 }
		}
		country_event = {
			id = KOR_parliament.2
		}
	}
}